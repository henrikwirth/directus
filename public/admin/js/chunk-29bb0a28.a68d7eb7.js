(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-29bb0a28"],{1993:function(e,t,i){},"669d":function(e,t,i){"use strict";var n=i("1993"),a=i.n(n);a.a},"6ab8":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"input-single-file"},[e.value?i("div",{staticClass:"preview"},e._l(e.files,function(t,n){return i("v-card",{key:t.id,staticClass:"card",attrs:{title:t.title,subtitle:t.subtitle,src:t.src,icon:t.icon,href:t.href,options:{remove:{text:e.$t("delete"),icon:"delete"},edit:{text:e.$t("interfaces-files-edit_item"),icon:"edit"}}},on:{remove:function(i){return e.deleteFile(t[e.relatedPrimaryKeyField.field])},edit:function(t){return e.editFile(n)}}})}),1):e._e(),i("v-button",{attrs:{type:"button",disabled:e.readonly},on:{click:function(t){e.newFile=!0}}},[i("v-icon",{attrs:{name:"add"}}),e._v("\n    "+e._s(e.$t("new_file"))+"\n  ")],1),i("v-button",{attrs:{type:"button",disabled:e.readonly},on:{click:function(t){e.existing=!0}}},[i("v-icon",{attrs:{name:"playlist_add"}}),e._v("\n    "+e._s(e.$t("existing"))+"\n  ")],1),e.newFile?i("portal",{attrs:{to:"modal"}},[i("v-modal",{attrs:{buttons:{done:{text:e.$t("done")}},title:e.$t("file_upload")},on:{close:function(t){e.newFile=!1},done:function(t){e.newFile=!1}}},[i("div",{staticClass:"body"},[i("v-upload",{attrs:{multiple:!0,accept:e.options.accept},on:{upload:e.saveUpload}})],1)])],1):e._e(),e.existing?i("portal",{attrs:{to:"modal"}},[i("v-modal",{attrs:{title:e.$t("choose_one"),buttons:{done:{text:e.$t("done")}},"action-required":""},on:{close:function(t){e.existing=!1},done:function(t){e.existing=!1}}},[i("div",{staticClass:"search"},[i("v-input",{staticClass:"search-input",attrs:{type:"search",placeholder:e.$t("search")},on:{input:e.onSearchInput}})],1),i("v-items",{staticClass:"items",attrs:{collection:e.relation.junction.collection_one.collection,"view-type":e.viewType,selection:e.selection,filters:e.filters,"view-query":e.viewQuery,"view-options":e.viewOptions},on:{options:e.setViewOptions,query:e.setViewQuery,select:e.selectItems}})],1)],1):e._e(),e.editExisting?i("portal",{staticClass:"edit-modal",attrs:{to:"modal"}},[i("v-modal",{attrs:{title:e.$t("editing_item"),buttons:{save:{text:"Save",color:"accent",loading:e.selectionSaving}}},on:{close:function(t){e.editExisting=!1},save:e.saveEdits}},[i("div",{staticClass:"edit-modal-body"},[i("v-form",{attrs:{fields:e.relatedCollectionFields,values:e.editExisting[e.junctionFieldName]},on:{"stage-value":e.stageValue}})],1)])],1):e._e()],1)},a=[],r=(i("6762"),i("2fdb"),i("bd86")),s=i("75fc"),o=i("cebc"),l=(i("f559"),i("28a5"),i("7514"),i("8db2")),u=i.n(l);function c(e){return"application/pdf"===e?"picture_as_pdf":e.startsWith("application")?"insert_drive_file":e.startsWith("image")?"crop_original":e.startsWith("video")?"videocam":e.startsWith("code")?"code":e.startsWith("audio")?"audiotrack":"save"}var d={mixins:[u.a],data:function(){return{newFile:!1,existing:!1,editExisting:!1,selectionSaving:!1,viewOptionsOverride:{},viewTypeOverride:null,viewQueryOverride:{},filtersOverride:[],editThisFile:{},edits:{}}},computed:{junctionFieldName:function(){return this.relation.junction.field_many.field},relatedCollectionFields:function(){return this.relation.junction.collection_one.fields},junctionPrimaryKey:function(){return _.find(this.relation.collection_many.fields,{primary_key:!0}).field},files:function(){var e=this;return this.value?this.value.filter(function(e){return!e.$delete}).map(function(t){var i=t[e.junctionFieldName];return{id:i[e.relatedPrimaryKeyField.field],title:i.title,subtitle:i.filename.split(".").pop()+" • "+e.$d(new Date(i.uploaded_on),"short"),src:i.type&&i.type.startsWith("image")?i.data.thumbnails[0].url:null,icon:i.type&&!i.type.startsWith("image")?c(i.type):null,href:i.type&&"application/pdf"===i.type?i.data.full_url:null}}):[]},relatedPrimaryKeyField:function(){return _.find(this.relation.junction.collection_one.fields,{primary_key:!0})},selection:function(){var e=this;return this.value?this.value.filter(function(e){return!e.$delete}).map(function(t){return t[e.junctionFieldName]}):[]},viewOptions:function(){var e=this.options.viewOptions;return Object(o["a"])({},e,this.viewOptionsOverride)},viewType:function(){return this.viewTypeOverride?this.viewTypeOverride:this.options.viewType},viewQuery:function(){var e=this.options.viewQuery;return Object(o["a"])({},e,this.viewQueryOverride)},filters:function(){return[].concat(Object(s["a"])(this.options.filters),Object(s["a"])(this.fileTypeFilters),Object(s["a"])(this.filtersOverride))},fileTypeFilters:function(){return!this.options.accept||this.filtersOverride.length>0||this.options.filters.some(function(e){return"type"===e.field})?[]:[{field:"type",operator:"in",value:this.options.accept.trim().split(/,\s*/)}]}},methods:{saveUpload:function(e){this.$emit("input",[].concat(Object(s["a"])(this.value),[Object(r["a"])({},this.junctionFieldName,e.data)]))},selectItems:function(e){var t=this,i=this.value||[],n=i.map(function(e){return e[t.junctionFieldName]}),a=this.relatedPrimaryKeyField.field,l=n.map(function(e){return e[a]}),u=e.map(function(e){return e[a]}),c=l.filter(function(e){return!1===u.includes(e)}),d=i.filter(function(e){return c.includes(e[t.junctionFieldName][a])}).map(function(e){return Object(o["a"])({},e,{$delete:!0})}),p=e.map(function(e){return Object(r["a"])({},t.junctionFieldName,e)});this.$emit("input",[].concat(Object(s["a"])(d),Object(s["a"])(p)))},deleteFile:function(e){var t=this,i=this.value.map(function(i){var n=i[t.junctionFieldName];return n[t.relatedPrimaryKeyField.field]===e?Object(o["a"])({},i,{$delete:!0}):i});this.$emit("input",i)},editFile:function(e){this.editExisting=this.value[e]},stageValue:function(e){var t=e.field,i=e.value;this.$set(this.edits,t,i)},saveEdits:function(){var e=this;this.$emit("input",Object(s["a"])((this.value||[]||[]).map(function(t){return t.id===e.editExisting[e.junctionPrimaryKey]?Object(o["a"])({},t,Object(r["a"])({},e.junctionFieldName,Object(o["a"])({},t[e.junctionFieldName],e.edits))):t}))),this.edits={},this.editExisting=!1},setViewOptions:function(e){this.viewOptionsOverride=Object(o["a"])({},this.viewOptionsOverride,e)},setViewQuery:function(e){this.viewQueryOverride=Object(o["a"])({},this.viewQueryOverride,e)},onSearchInput:function(e){this.setViewQuery({q:e})}},created:function(){this.onSearchInput=_.debounce(this.onSearchInput,200)}},p=d,f=(i("669d"),i("2877")),v=Object(f["a"])(p,n,a,!1,null,"a27ea2fe",null);t["default"]=v.exports},"8db2":function(e,t){e.exports={props:{id:{type:String,required:!0},name:{type:String,required:!0},value:{type:null,default:null},type:{type:String,required:!0},length:{type:[String,Number],default:null},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},newItem:{type:Boolean,default:!1},relation:{type:Object,default:null},fields:{type:Object,default:null},values:{type:Object,default:null}}}}}]);
//# sourceMappingURL=chunk-29bb0a28.a68d7eb7.js.map